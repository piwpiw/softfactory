<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¤ìŠ¤í…€ ì½”ë“œ ì—ë””í„° â€” SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/atom-one-dark.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="../platform/api.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .editor { font-family: 'Monaco', 'Menlo', monospace; }
        .code-line { line-height: 1.6; }
        hljs { background: #1e1e1e !important; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0">
            <div class="p-6 border-b border-slate-800">
                <a href="index.html" class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ­</span>
                    <div><h1 class="font-bold text-white text-sm">SoftFactory</h1><p class="text-xs text-slate-400">â† ë’¤ë¡œ</p></div>
                </a>
            </div>
            <nav class="flex-1 p-6 space-y-2 overflow-y-auto">
                <p class="text-xs font-semibold text-slate-400 uppercase px-4 mb-3">ğŸ¤– AI Auto</p>
                <a href="index.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
                <a href="scenarios.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤</a>
                <a href="create.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">âœ¨ ìƒì„±</a>
                <a href="code.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg bg-cyan-600 text-white font-medium">ğŸ’» ì»¤ìŠ¤í…€ ì½”ë“œ</a>
                <a href="analytics.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“ˆ ë¶„ì„</a>
            </nav>
            <div class="p-6 border-t border-slate-800">
                <button onclick="logout()" class="p-2 hover:bg-slate-800 rounded-lg">ğŸšª</button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-16 bg-slate-900 border-b border-slate-800 px-6 flex items-center justify-between shrink-0">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">ğŸ’» ì»¤ìŠ¤í…€ ì½”ë“œ ì—ë””í„°</h2>
                <div class="flex gap-3">
                    <button onclick="saveCode()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition">
                        ğŸ’¾ ì €ì¥
                    </button>
                    <button onclick="runCode()" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium text-sm transition">
                        â–¶ ì‹¤í–‰
                    </button>
                </div>
            </header>

            <!-- Main Area -->
            <main class="flex-1 overflow-hidden flex gap-4 p-4">
                <!-- Code Editor -->
                <div class="flex-1 flex flex-col bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                    <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 flex items-center justify-between">
                        <div class="text-sm font-medium text-slate-300">
                            <span class="text-cyan-400">ğŸ“„</span> workflow.js
                        </div>
                        <div class="text-xs text-slate-500">ë¼ì¸: <span id="lineNumber">1</span> | ì»¬ëŸ¼: <span id="colNumber">1</span></div>
                    </div>
                    <div class="flex-1 overflow-hidden relative">
                        <textarea
                            id="codeEditor"
                            class="absolute inset-0 bg-slate-900 text-slate-100 p-4 font-mono text-sm resize-none focus:outline-none"
                            spellcheck="false"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off">// AI ìë™í™” ì›Œí¬í”Œë¡œìš° ì»¤ìŠ¤í…€ ì½”ë“œ
// ===================================

// Step 1: ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
async function loadData(source) {
    const response = await fetch(`/api/${source}`);
    return await response.json();
}

// Step 2: ë°ì´í„° ì²˜ë¦¬
function processData(data) {
    return data.filter(item => item.active === true)
               .map(item => ({
                   id: item.id,
                   name: item.name,
                   timestamp: new Date().toISOString()
               }));
}

// Step 3: ê²°ê³¼ ì €ì¥
async function saveResult(result) {
    const response = await fetch('/api/workflow/result', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(result)
    });
    return response.ok;
}

// ë©”ì¸ ì‹¤í–‰
async function main() {
    try {
        const rawData = await loadData('data-source');
        const processed = processData(rawData);
        await saveResult({
            status: 'success',
            count: processed.length,
            data: processed
        });
        console.log('âœ… ì›Œí¬í”Œë¡œìš° ì™„ë£Œ');
    } catch (error) {
        console.error('âŒ ì˜¤ë¥˜:', error);
    }
}

// ì‹¤í–‰
main();</textarea>
                        <pre class="absolute inset-0 bg-slate-900 text-slate-100 p-4 font-mono text-sm pointer-events-none overflow-hidden" id="highlightPre"><code id="highlight" class="language-javascript"></code></pre>
                    </div>
                </div>

                <!-- Right Panel: Help & Output -->
                <div class="w-80 flex flex-col gap-4 overflow-hidden">
                    <!-- API Reference -->
                    <div class="flex-1 bg-slate-800 rounded-lg border border-slate-700 overflow-hidden flex flex-col">
                        <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 font-semibold text-cyan-400">
                            ğŸ“š API ë ˆí¼ëŸ°ìŠ¤
                        </div>
                        <div class="flex-1 overflow-y-auto p-4 space-y-3 text-sm">
                            <div class="bg-slate-900 p-3 rounded border border-slate-700">
                                <div class="text-cyan-400 font-mono text-xs">GET /api/data</div>
                                <p class="text-slate-400 text-xs mt-1">ë°ì´í„° ì†ŒìŠ¤ì—ì„œ í•­ëª© ë¶ˆëŸ¬ì˜¤ê¸°</p>
                            </div>
                            <div class="bg-slate-900 p-3 rounded border border-slate-700">
                                <div class="text-cyan-400 font-mono text-xs">POST /api/workflow/result</div>
                                <p class="text-slate-400 text-xs mt-1">ì²˜ë¦¬ ê²°ê³¼ ì €ì¥í•˜ê¸°</p>
                            </div>
                            <div class="bg-slate-900 p-3 rounded border border-slate-700">
                                <div class="text-cyan-400 font-mono text-xs">PUT /api/workflow/status</div>
                                <p class="text-slate-400 text-xs mt-1">ì›Œí¬í”Œë¡œìš° ìƒíƒœ ì—…ë°ì´íŠ¸</p>
                            </div>
                            <div class="bg-slate-900 p-3 rounded border border-slate-700">
                                <div class="text-cyan-400 font-mono text-xs">DELETE /api/workflow/task/{id}</div>
                                <p class="text-slate-400 text-xs mt-1">ì‘ì—… ì·¨ì†Œí•˜ê¸°</p>
                            </div>
                        </div>
                    </div>

                    <!-- Output Console -->
                    <div class="flex-1 bg-slate-800 rounded-lg border border-slate-700 overflow-hidden flex flex-col">
                        <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 font-semibold text-green-400 flex items-center justify-between">
                            <span>ğŸ–¥ ì‹¤í–‰ ê²°ê³¼</span>
                            <button onclick="clearConsole()" class="text-xs text-slate-400 hover:text-slate-200">Clear</button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 font-mono text-xs bg-slate-900 space-y-1" id="console">
                            <div class="text-slate-500">â€¢ ì¤€ë¹„ë¨. â–¶ ì‹¤í–‰ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        requireAuth();

        const editor = document.getElementById('codeEditor');
        const highlight = document.getElementById('highlight');
        const highlightPre = document.getElementById('highlightPre');
        const consoleOutput = document.getElementById('console');

        // Sync scroll between editor and highlight
        editor.addEventListener('scroll', () => {
            highlightPre.scrollTop = editor.scrollTop;
            highlightPre.scrollLeft = editor.scrollLeft;
        });

        // Update highlighting as user types
        editor.addEventListener('input', () => {
            const code = editor.value;
            highlight.textContent = code;
            hljs.highlightElement(highlight);

            // Update line number
            const lines = editor.value.substring(0, editor.selectionStart).split('\n');
            document.getElementById('lineNumber').textContent = lines.length;
            document.getElementById('colNumber').textContent = lines[lines.length - 1].length + 1;
        });

        // Track cursor position
        editor.addEventListener('keyup', () => {
            const lines = editor.value.substring(0, editor.selectionStart).split('\n');
            document.getElementById('lineNumber').textContent = lines.length;
            document.getElementById('colNumber').textContent = lines[lines.length - 1].length + 1;
        });

        // Initial highlight
        highlight.textContent = editor.value;
        hljs.highlightElement(highlight);

        function addConsoleLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-slate-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            };
            const color = colors[type] || colors.info;

            const line = document.createElement('div');
            line.className = color;
            line.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '<div class="text-slate-500">â€¢ ì½˜ì†” ì´ˆê¸°í™”ë¨</div>';
        }

        function saveCode() {
            const code = editor.value;
            localStorage.setItem('customCode', code);
            addConsoleLog('âœ… ì½”ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function runCode() {
            clearConsole();
            addConsoleLog('ğŸš€ ì½”ë“œ ì‹¤í–‰ ì‹œì‘...', 'info');

            try {
                // Parse and validate code
                new Function(editor.value);
                addConsoleLog('âœ… ë¬¸ë²• ê²€ì‚¬ í†µê³¼', 'success');

                // Simulate execution
                setTimeout(() => {
                    addConsoleLog('ğŸ“Š ë°ì´í„° ë¡œë“œ: 42ê°œ í•­ëª©', 'info');
                }, 500);

                setTimeout(() => {
                    addConsoleLog('âš™ ì²˜ë¦¬ ì¤‘...', 'info');
                }, 1000);

                setTimeout(() => {
                    addConsoleLog('ğŸ’¾ ê²°ê³¼ ì €ì¥ ì™„ë£Œ', 'success');
                    addConsoleLog('â± ì‹¤í–‰ ì‹œê°„: 2.34s', 'info');
                    addConsoleLog('âœ… ì›Œí¬í”Œë¡œìš° ì™„ë£Œ', 'success');
                }, 1500);
            } catch (error) {
                addConsoleLog(`âŒ ë¬¸ë²• ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // Load saved code
        const savedCode = localStorage.getItem('customCode');
        if (savedCode) {
            editor.value = savedCode;
            highlight.textContent = savedCode;
            hljs.highlightElement(highlight);
        }
    </script>
</body>
</html>
