<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
<title>ì»¤ìŠ¤í…€ ì½”ë“œ ì—ë””í„° â€” SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js/languages/javascript.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js/styles/atom-one-dark.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.4.13/src-min-noconflict/ace.js"></script>
    <script src="../platform/api.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .editor { font-family: 'Monaco', 'Menlo', 'Courier New', monospace; }
        .code-line { line-height: 1.6; }
        hljs { background: #1e1e1e !important; }
        #editor-container { position: relative; width: 100%; height: 100%; }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-success { background-color: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .status-error { background-color: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .status-info { background-color: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .console-entry {
            padding: 0.5rem;
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
            font-family: 'Monaco', monospace;
        }
        .template-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: rgba(6, 182, 212, 0.1);
            color: #06b6d4;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-right: 0.5rem;
        }
    </style>
    <link rel="stylesheet" href="../responsive-framework.css">
  </head>
<body class="bg-slate-950 text-slate-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0">
            <div class="p-6 border-b border-slate-800">
                <a href="index.html" class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ­</span>
                    <div><h1 class="font-bold text-white text-sm">SoftFactory</h1><p class="text-xs text-slate-400">â† ë’¤ë¡œ</p></div>
                </a>
            </div>
            <nav class="flex-1 p-6 space-y-2 overflow-y-auto">
    <button class="hamburger" aria-label="Toggle navigation menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
                <p class="text-xs font-semibold text-slate-400 uppercase px-4 mb-3">ğŸ¤– AI Auto</p>
                <a href="index.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
                <a href="scenarios.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤</a>
                <a href="create.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">âœ¨ ìƒì„±</a>
                <a href="code.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg bg-cyan-600 text-white font-medium">ğŸ’» ì»¤ìŠ¤í…€ ì½”ë“œ</a>
                <a href="analytics.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">ğŸ“ˆ ë¶„ì„</a>
            </nav>
            <div class="p-6 border-t border-slate-800">
                <button onclick="logout()" class="p-2 hover:bg-slate-800 rounded-lg">ğŸšª</button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-16 bg-slate-900 border-b border-slate-800 px-6 flex items-center justify-between shrink-0">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">ğŸ’» ì»¤ìŠ¤í…€ ì½”ë“œ ì—ë””í„°</h2>
                <div class="flex gap-3">
                    <button onclick="saveCode()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition">
                        ğŸ’¾ ì €ì¥
                    </button>
                    <button onclick="runCode()" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium text-sm transition">
                        â–¶ ì‹¤í–‰
                    </button>
                </div>
            </header>

            <!-- Main Area -->
            <main class="flex-1 overflow-hidden flex gap-4 p-4">
                <!-- Code Editor -->
                <div class="flex-1 flex flex-col bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                    <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 flex items-center justify-between">
                        <div class="text-sm font-medium text-slate-300">
                            <span class="text-cyan-400">ğŸ“„</span> workflow.js
                        </div>
                        <div class="text-xs text-slate-500">ë¼ì¸: <span id="lineNumber">1</span> | ì»¬ëŸ¼: <span id="colNumber">1</span></div>
                    </div>
                    <div class="flex-1 overflow-hidden relative">
                        <textarea
                            id="codeEditor"
                            class="absolute inset-0 bg-slate-900 text-slate-100 p-4 font-mono text-sm resize-none focus:outline-none"
                            spellcheck="false"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off">// AI ìë™í™” ì›Œí¬í”Œë¡œìš° ì»¤ìŠ¤í…€ ì½”ë“œ
// ===================================

// Step 1: ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
async function loadData(source) {
    const response = await fetch(`/api/${source}`);
    return await response.json();
}

// Step 2: ë°ì´í„° ì²˜ë¦¬
function processData(data) {
    return data.filter(item => item.active === true)
               .map(item => ({
                   id: item.id,
                   name: item.name,
                   timestamp: new Date().toISOString()
               }));
}

// Step 3: ê²°ê³¼ ì €ì¥
async function saveResult(result) {
    const response = await fetch('/api/workflow/result', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(result)
    });
    return response.ok;
}

// ë©”ì¸ ì‹¤í–‰
async function main() {
    try {
        const rawData = await loadData('data-source');
        const processed = processData(rawData);
        await saveResult({
            status: 'success',
            count: processed.length,
            data: processed
        });
        console.log('âœ… ì›Œí¬í”Œë¡œìš° ì™„ë£Œ');
    } catch (error) {
        console.error('âŒ ì˜¤ë¥˜:', error);
    }
}

// ì‹¤í–‰
main();</textarea>
                        <pre class="absolute inset-0 bg-slate-900 text-slate-100 p-4 font-mono text-sm pointer-events-none overflow-hidden" id="highlightPre"><code id="highlight" class="language-javascript"></code></pre>
                    </div>
                </div>

                <!-- Right Panel: Help & Output -->
                <div class="w-80 flex flex-col gap-4 overflow-hidden">
                    <!-- Templates Sidebar -->
                    <div class="flex-1 bg-slate-800 rounded-lg border border-slate-700 overflow-hidden flex flex-col">
                        <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 font-semibold text-cyan-400 flex items-center justify-between">
                            <span>ğŸ“š ì½”ë“œ í…œí”Œë¦¿</span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 space-y-2 text-sm" id="templatesList">
                            <div class="text-slate-500 px-3 py-2">ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>

                    <!-- Output Console -->
                    <div class="flex-1 bg-slate-800 rounded-lg border border-slate-700 overflow-hidden flex flex-col">
                        <div class="bg-slate-900 border-b border-slate-700 px-4 py-3 font-semibold text-green-400 flex items-center justify-between">
                            <span>ğŸ–¥ ì‹¤í–‰ ê²°ê³¼</span>
                            <button onclick="clearConsole()" class="text-xs text-slate-400 hover:text-slate-200">Clear</button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-3 font-mono text-xs bg-slate-900 space-y-1" id="console">
                            <div class="text-slate-500">â€¢ ì¤€ë¹„ë¨. â–¶ ì‹¤í–‰ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        requireAuth();

        const editor = document.getElementById('codeEditor');
        const consoleOutput = document.getElementById('console');
        const templatesList = document.getElementById('templatesList');
        let isExecuting = false;

        // API endpoints
        const API_BASE = '/api/ai-automation';

        // Load templates
        async function loadTemplates() {
            try {
                const response = await fetch(`${API_BASE}/code/templates`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const data = await response.json();

                if (data.templates && data.templates.length > 0) {
                    templatesList.innerHTML = data.templates.map(template => `
                        <div onclick="loadTemplate('${template.id}')" class="bg-slate-900 p-3 rounded border border-slate-700 cursor-pointer hover:border-cyan-500 transition">
                            <div class="text-cyan-400 font-medium text-sm">${template.name}</div>
                            <p class="text-slate-400 text-xs mt-1">${template.description}</p>
                        </div>
                    `).join('');
                } else {
                    templatesList.innerHTML = '<div class="text-slate-500 px-3 py-2">í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            } catch (error) {
                console.error('Failed to load templates:', error);
                templatesList.innerHTML = '<div class="text-red-400 px-3 py-2">í…œí”Œë¦¿ ë¡œë”© ì‹¤íŒ¨</div>';
            }
        }

        // Load specific template
        async function loadTemplate(templateId) {
            try {
                const response = await fetch(`${API_BASE}/code/templates/${templateId}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const template = await response.json();

                editor.value = template.code;
                updateHighlight();
                addConsoleLog(`ğŸ“š í…œí”Œë¦¿ ë¡œë“œë¨: ${template.name}`, 'info');
            } catch (error) {
                addConsoleLog(`âŒ í…œí”Œë¦¿ ë¡œë”© ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // Update code highlighting
        function updateHighlight() {
            const code = editor.value;
            const lines = code.substring(0, editor.selectionStart).split('\n');
            document.getElementById('lineNumber').textContent = lines.length;
            document.getElementById('colNumber').textContent = lines[lines.length - 1].length + 1;
        }

        // Sync scroll
        editor.addEventListener('scroll', () => {
            const highlight = document.getElementById('highlightPre');
            highlight.scrollTop = editor.scrollTop;
            highlight.scrollLeft = editor.scrollLeft;
        });

        // Update highlight on input
        editor.addEventListener('input', () => {
            const code = editor.value;
            const highlight = document.getElementById('highlight');
            highlight.textContent = code;
            hljs.highlightElement(highlight);
            updateHighlight();
        });

        // Track cursor position
        editor.addEventListener('keyup', updateHighlight);

        // Initial highlight
        editor.addEventListener('input', () => {});
        const code = editor.value;
        document.getElementById('highlight').textContent = code;
        hljs.highlightElement(document.getElementById('highlight'));

        function addConsoleLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const typeEmoji = {
                'info': 'â€¢',
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ',
                'log': 'ğŸ“'
            };
            const colors = {
                'info': 'text-slate-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400',
                'log': 'text-blue-400'
            };
            const color = colors[type] || colors.info;
            const emoji = typeEmoji[type] || 'â€¢';

            const line = document.createElement('div');
            line.className = `console-entry ${color}`;
            line.textContent = `[${timestamp}] ${emoji} ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '<div class="text-slate-500 console-entry">â€¢ ì½˜ì†” ì´ˆê¸°í™”ë¨</div>';
        }

        function saveCode() {
            const code = editor.value;
            localStorage.setItem('customCode', code);
            addConsoleLog('ì½”ë“œê°€ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        async function runCode() {
            if (isExecuting) {
                addConsoleLog('ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const code = editor.value;
            if (!code || !code.trim()) {
                addConsoleLog('ì‹¤í–‰í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            clearConsole();
            isExecuting = true;
            addConsoleLog('ì½”ë“œ ì‹¤í–‰ ì‹œì‘...', 'info');
            document.querySelector('button:contains("ì‹¤í–‰")').disabled = true;

            try {
                // Validate code first
                const validateResponse = await fetch(`${API_BASE}/code/validate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ code })
                });

                const validateData = await validateResponse.json();
                if (!validateData.valid) {
                    addConsoleLog(`ë¬¸ë²• ê²€ì‚¬ ì˜¤ë¥˜: ${validateData.error}`, 'error');
                    isExecuting = false;
                    return;
                }

                addConsoleLog('ë¬¸ë²• ê²€ì‚¬ ì™„ë£Œ', 'success');

                // Execute code
                const response = await fetch(`${API_BASE}/code/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        code,
                        timeout_ms: 5000
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    addConsoleLog('ì½”ë“œ ì‹¤í–‰ ì„±ê³µ', 'success');

                    // Display console logs
                    if (result.console_logs && result.console_logs.length > 0) {
                        result.console_logs.forEach(log => {
                            if (log.startsWith('[ERROR]')) {
                                addConsoleLog(log, 'error');
                            } else if (log.startsWith('[WARN]')) {
                                addConsoleLog(log, 'warning');
                            } else if (log.startsWith('[INFO]')) {
                                addConsoleLog(log, 'info');
                            } else {
                                addConsoleLog(log, 'log');
                            }
                        });
                    }

                    // Display execution time
                    addConsoleLog(`ì‹¤í–‰ ì‹œê°„: ${result.execution_time}ì´ˆ`, 'info');

                    // Display return value if exists
                    if (result.return_value && Object.keys(result.return_value).length > 0) {
                        addConsoleLog(`ê²°ê³¼: ${JSON.stringify(result.return_value)}`, 'success');
                    }
                } else if (result.status === 'timeout') {
                    addConsoleLog('ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ (5ì´ˆ)', 'error');
                } else if (result.status === 'validation_error') {
                    addConsoleLog(`ë¬¸ë²• ì˜¤ë¥˜: ${result.error}`, 'error');
                } else {
                    addConsoleLog(`ì‹¤í–‰ ì˜¤ë¥˜: ${result.error || 'Unknown error'}`, 'error');
                    if (result.console_logs && result.console_logs.length > 0) {
                        result.console_logs.forEach(log => addConsoleLog(log, 'log'));
                    }
                }
            } catch (error) {
                addConsoleLog(`í†µì‹  ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                isExecuting = false;
                document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }
        }

        // Load saved code
        const savedCode = localStorage.getItem('customCode');
        if (savedCode) {
            editor.value = savedCode;
            document.getElementById('highlight').textContent = savedCode;
            hljs.highlightElement(document.getElementById('highlight'));
        }

        // Initialize
        loadTemplates();
    </script>
    <script src="../mobile-optimization.js" defer></script>
</body>
</html>
