<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½ ê´€ë¦¬ â€” SNS Auto | SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="../platform/api.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0">
            <div class="p-6 border-b border-slate-800">
                <a href="../platform/dashboard.html" class="flex items-center gap-3">
                    <span class="text-2xl">ğŸ­</span>
                    <div>
                        <h1 class="font-bold text-white text-sm">SoftFactory</h1>
                        <p class="text-xs text-slate-400">â† Back</p>
                    </div>
                </a>
            </div>
            <nav class="flex-1 p-6 space-y-2 overflow-y-auto">
                <p class="text-xs font-semibold text-slate-400 uppercase px-4 mb-3">ğŸ“± SNS Auto</p>
                <a href="index.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800 transition">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
                <a href="accounts.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800 transition">ğŸ”— ê³„ì • ì—°ë™</a>
                <a href="create.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800 transition">âœï¸ í¬ìŠ¤íŠ¸ ì‘ì„±</a>
                <a href="schedule.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg bg-pink-600 text-white font-medium">ğŸ“… ì˜ˆì•½ ê´€ë¦¬</a>
            </nav>
            <div class="p-6 border-t border-slate-800">
                <div class="flex items-center justify-between">
                    <p class="text-sm font-medium text-white">Demo User</p>
                    <button onclick="logout()" class="p-2 hover:bg-slate-800 rounded-lg">ğŸšª</button>
                </div>
            </div>
        </aside>
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-16 bg-slate-900 border-b border-slate-800 px-6 flex items-center justify-between shrink-0">
                <div>
                    <h2 class="text-xl font-bold text-white">ğŸ“… ì˜ˆì•½ ê´€ë¦¬</h2>
                    <p class="text-xs text-slate-400">ì˜ˆì•½ëœ í¬ìŠ¤íŠ¸ ì¼ì •</p>
                </div>
                <a href="create.html" class="px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium text-sm">+ ìƒˆ í¬ìŠ¤íŠ¸</a>
            </header>
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Month Navigation -->
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-white"><span id="monthYear">2026ë…„ 2ì›”</span></h3>
                    <div class="flex gap-2">
                        <button onclick="previousMonth()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm">â† ì´ì „ë‹¬</button>
                        <button onclick="nextMonth()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm">ë‹¤ìŒë‹¬ â†’</button>
                    </div>
                </div>

                <!-- Calendar Header -->
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">ì›”</div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">í™”</div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">ìˆ˜</div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">ëª©</div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">ê¸ˆ</div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">í† </div>
                    <div class="text-xs font-semibold text-slate-400 text-center py-2">ì¼</div>
                </div>

                <!-- Calendar Grid -->
                <div class="grid grid-cols-7 gap-2 mb-8" id="calendarGrid">
                    <!-- Generated by JavaScript -->
                </div>

                <h3 class="text-lg font-bold text-white mb-4">ğŸ“‹ ì˜ˆì•½ëœ í¬ìŠ¤íŠ¸ ëª©ë¡</h3>
                <div class="space-y-3" id="scheduledPosts">
                    <!-- Posts loaded from API -->
                </div>
            </main>
        </div>
    </div>
    <script>
        requireAuth();

        let currentDate = new Date();

        async function init() {
            renderCalendar();
            loadScheduledPosts();
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthStr = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'][month];

            document.getElementById('monthYear').textContent = `${year}ë…„ ${monthStr}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            let current = new Date(startDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = 0; i < 42; i++) {
                const cell = document.createElement('div');
                const cellDate = new Date(current);
                cellDate.setHours(0, 0, 0, 0);
                const isCurrentMonth = current.getMonth() === month;
                const isToday = cellDate.getTime() === today.getTime();

                cell.className = `bg-slate-800 rounded-lg p-3 border text-center min-h-24 cursor-pointer hover:border-pink-600 transition ${
                    isCurrentMonth ? 'border-slate-700' : 'border-slate-900 opacity-30'
                } ${isToday ? 'ring-2 ring-pink-600' : ''}`;

                const dayNum = document.createElement('div');
                dayNum.className = `text-lg font-bold ${isCurrentMonth ? 'text-white' : 'text-slate-600'}`;
                dayNum.textContent = current.getDate();
                cell.appendChild(dayNum);

                const countDiv = document.createElement('div');
                countDiv.className = `text-xs mt-2 ${isCurrentMonth ? 'text-slate-400' : 'text-slate-600'}`;
                countDiv.textContent = '0ê°œ';
                cell.appendChild(countDiv);

                cell.onclick = () => {
                    if (isCurrentMonth) {
                        const dateStr = current.toISOString().split('T')[0];
                        scrollToPostsOnDate(dateStr);
                    }
                };

                grid.appendChild(cell);
                current.setDate(current.getDate() + 1);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        async function loadScheduledPosts() {
            try {
                const result = await apiFetch('/api/sns/posts?status=scheduled').then(r => r.json());
                const posts = result.posts || [];
                const container = document.getElementById('scheduledPosts');

                if (posts.length === 0) {
                    container.innerHTML = '<div class="text-slate-400 text-center py-8">ì˜ˆì•½ëœ í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }

                container.innerHTML = posts.map(post => `
                    <div class="bg-slate-800 rounded-lg p-4 border border-slate-700 flex items-start justify-between hover:border-pink-600 transition">
                        <div>
                            <p class="text-sm font-medium text-white">${post.content.substring(0, 50)}...</p>
                            <p class="text-xs text-slate-400 mt-1">ğŸ“± ${post.platform}</p>
                            <p class="text-xs text-pink-400 mt-2">ğŸ“… ${new Date(post.scheduled_at).toLocaleString('ko-KR')}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editPost(${post.id})" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition">ìˆ˜ì •</button>
                            <button onclick="cancelPost(${post.id})" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition">ì·¨ì†Œ</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showError('í¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
            }
        }

        function scrollToPostsOnDate(dateStr) {
            document.getElementById('scheduledPosts').scrollIntoView({ behavior: 'smooth' });
        }

        async function editPost(postId) {
            // TODO: Implement edit modal
            showWarning('ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤');
        }

        async function cancelPost(postId) {
            if (!confirm('ì´ í¬ìŠ¤íŠ¸ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                await apiFetch(`/api/sns/posts/${postId}`, { method: 'DELETE' });
                showSuccess('í¬ìŠ¤íŠ¸ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤');
                loadScheduledPosts();
            } catch (error) {
                showError('ì·¨ì†Œ ì‹¤íŒ¨');
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
