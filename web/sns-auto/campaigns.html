<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
<title>캠페인 관리 — SNS Auto | SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="../platform/api.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
    <link rel="stylesheet" href="../responsive-framework.css">
  </head>
<body class="bg-slate-950 text-slate-100 antialiased">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0">
            <div class="p-6 border-b border-slate-800">
                <a href="../platform/dashboard.html" class="flex items-center gap-3">
                    <span class="text-2xl">🏭</span>
                    <div>
                        <h1 class="font-bold text-white text-sm">SoftFactory</h1>
                        <p class="text-xs text-slate-400">← Back</p>
                    </div>
                </a>
            </div>
            <nav class="flex-1 p-6 space-y-2 overflow-y-auto">
                <button class="hamburger" aria-label="Toggle navigation menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
<p class="text-xs font-semibold text-slate-400 uppercase px-4 mb-3">📱 SNS Auto</p>
                <a href="index.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">📊 대시보드</a>
                <a href="accounts.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">🔗 계정 연동</a>
                <a href="create.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">✍️ 블로그 자동포스팅</a>
                <a href="schedule.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">📅 스케줄 관리</a>
                <a href="analytics.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">📈 분석</a>
                <a href="templates.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">🎨 템플릿</a>
                <a href="settings.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">⚙️ 설정</a>
                <a href="inbox.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-800">💬 인박스</a>
                <a href="campaigns.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg bg-pink-600 text-white font-medium">📢 캠페인</a>
            </nav>
            <div class="p-6 border-t border-slate-800">
                <div class="flex items-center justify-between">
                    <p class="text-sm font-medium text-white">Demo User</p>
                    <button onclick="logout()" class="p-2 hover:bg-slate-800 rounded-lg transition">🚪</button>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-16 bg-slate-900 border-b border-slate-800 px-6 flex items-center justify-between shrink-0">
                <div>
                    <h2 class="text-xl font-bold text-white">📢 캠페인 관리</h2>
                    <p class="text-xs text-slate-400">여러 포스트를 캠페인으로 묶어서 관리하세요</p>
                </div>
                <button onclick="showCreateModal()" class="px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium transition text-sm">
                    + 새 캠페인
                </button>
            </header>

            <main class="flex-1 overflow-y-auto p-6 space-y-4" id="campaignsList">
                <!-- Campaigns loaded here -->
            </main>
        </div>
    </div>

    <!-- Create/Edit Campaign Modal -->
    <div id="campaignModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 border border-slate-700 rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto">
            <div class="p-6 border-b border-slate-700 sticky top-0 bg-slate-800">
                <h3 class="text-xl font-bold text-white" id="modalTitle">새 캠페인 만들기</h3>
            </div>

            <form id="campaignForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">캠페인명</label>
                    <input type="text" id="campaignName" placeholder="예: 봄 신상품 출시" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:border-pink-500 focus:outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">설명</label>
                    <textarea id="campaignDesc" placeholder="캠페인에 대한 설명을 입력하세요" class="w-full h-24 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:border-pink-500 focus:outline-none resize-none"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">대상 플랫폼</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" value="instagram" class="platformCheckbox w-4 h-4">
                            <span class="text-sm text-slate-300">Instagram</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" value="facebook" class="platformCheckbox w-4 h-4">
                            <span class="text-sm text-slate-300">Facebook</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" value="twitter" class="platformCheckbox w-4 h-4">
                            <span class="text-sm text-slate-300">Twitter</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" value="tiktok" class="platformCheckbox w-4 h-4">
                            <span class="text-sm text-slate-300">TikTok</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" value="linkedin" class="platformCheckbox w-4 h-4">
                            <span class="text-sm text-slate-300">LinkedIn</span>
                        </label>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">시작 날짜</label>
                        <input type="date" id="campaignStart" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white focus:border-pink-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">종료 날짜</label>
                        <input type="date" id="campaignEnd" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white focus:border-pink-500 focus:outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">상태</label>
                    <select id="campaignStatus" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white focus:border-pink-500 focus:outline-none">
                        <option value="active">진행 중</option>
                        <option value="paused">일시 중지</option>
                        <option value="completed">완료</option>
                    </select>
                </div>

                <div class="flex gap-3 justify-end pt-4 border-t border-slate-700">
                    <button type="button" onclick="closeCampaignModal()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-100 rounded-lg">
                        취소
                    </button>
                    <button type="submit" class="px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium">
                        저장하기
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        requireAuth();
        let editingCampaignId = null;

        async function init() {
            loadCampaigns();
        }

        async function loadCampaigns() {
            try {
                const result = await apiFetch('/api/sns/campaigns').then(r => r.json());
                const campaigns = result.campaigns || [];
                const container = document.getElementById('campaignsList');

                if (campaigns.length === 0) {
                    container.innerHTML = '<div class="text-slate-400 text-center py-12">캠페인이 없습니다. 새로 만들어보세요!</div>';
                    return;
                }

                container.innerHTML = campaigns.map(camp => {
                    const statusColor = camp.status === 'active' ? 'bg-green-900/50 border-green-700' :
                                       camp.status === 'paused' ? 'bg-yellow-900/50 border-yellow-700' :
                                       'bg-slate-800 border-slate-700';
                    const statusLabel = camp.status === 'active' ? '진행 중' :
                                       camp.status === 'paused' ? '일시 중지' : '완료';

                    return `
                        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700 hover:border-pink-600 transition">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-white">${camp.name}</h3>
                                    <p class="text-sm text-slate-400 mt-1">${camp.description || '설명 없음'}</p>
                                </div>
                                <span class="px-3 py-1 bg-slate-700 text-slate-300 text-xs rounded font-medium">${statusLabel}</span>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                                <div>
                                    <p class="text-slate-400">기간</p>
                                    <p class="text-white">${new Date(camp.start_date).toLocaleDateString('ko-KR')} ~ ${new Date(camp.end_date).toLocaleDateString('ko-KR')}</p>
                                </div>
                                <div>
                                    <p class="text-slate-400">플랫폼</p>
                                    <p class="text-white">${(camp.target_platforms || []).join(', ') || '전체'}</p>
                                </div>
                            </div>

                            <div class="mb-4 p-3 bg-slate-900 rounded-lg">
                                <p class="text-xs text-slate-400">연결된 포스트</p>
                                <p class="text-lg font-bold text-pink-400">${camp.post_count || 0}개</p>
                            </div>

                            <div class="flex gap-2 justify-end">
                                <button onclick="editCampaign(${camp.id})" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition">
                                    수정
                                </button>
                                <button onclick="deleteCampaign(${camp.id})" class="px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition">
                                    삭제
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                document.getElementById('campaignsList').innerHTML = '<div class="text-red-400 text-center py-12">캠페인 로드 실패</div>';
            }
        }

        function showCreateModal() {
            editingCampaignId = null;
            document.getElementById('modalTitle').textContent = '새 캠페인 만들기';
            document.getElementById('campaignForm').reset();
            document.getElementById('campaignModal').classList.remove('hidden');
        }

        function closeCampaignModal() {
            document.getElementById('campaignModal').classList.add('hidden');
            editingCampaignId = null;
        }

        async function editCampaign(campaignId) {
            try {
                const result = await apiFetch(`/api/sns/campaigns/${campaignId}`).then(r => r.json());
                const camp = result.campaign;

                document.getElementById('modalTitle').textContent = '캠페인 수정';
                document.getElementById('campaignName').value = camp.name;
                document.getElementById('campaignDesc').value = camp.description || '';
                document.getElementById('campaignStart').value = camp.start_date.split('T')[0];
                document.getElementById('campaignEnd').value = camp.end_date.split('T')[0];
                document.getElementById('campaignStatus').value = camp.status;

                // Set platforms
                document.querySelectorAll('.platformCheckbox').forEach(checkbox => {
                    checkbox.checked = camp.target_platforms.includes(checkbox.value);
                });

                editingCampaignId = campaignId;
                document.getElementById('campaignModal').classList.remove('hidden');
            } catch (error) {
                showError('캠페인 로드 실패');
            }
        }

        document.getElementById('campaignForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const platforms = Array.from(document.querySelectorAll('.platformCheckbox:checked')).map(c => c.value);
                const payload = {
                    name: document.getElementById('campaignName').value,
                    description: document.getElementById('campaignDesc').value,
                    target_platforms: platforms,
                    start_date: document.getElementById('campaignStart').value,
                    end_date: document.getElementById('campaignEnd').value,
                    status: document.getElementById('campaignStatus').value
                };

                if (editingCampaignId) {
                    await apiFetch(`/api/sns/campaigns/${editingCampaignId}`, {
                        method: 'PUT',
                        body: JSON.stringify(payload)
                    }).then(r => r.json());
                    showSuccess('캠페인이 수정되었습니다!');
                } else {
                    await apiFetch('/api/sns/campaigns', {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    }).then(r => r.json());
                    showSuccess('캠페인이 생성되었습니다!');
                }

                closeCampaignModal();
                loadCampaigns();
            } catch (error) {
                showError('저장 실패: ' + error.message);
            }
        });

        async function deleteCampaign(campaignId) {
            if (!confirm('이 캠페인을 삭제하시겠습니까? (연결된 포스트는 삭제되지 않습니다)')) return;
            try {
                await apiFetch(`/api/sns/campaigns/${campaignId}`, {
                    method: 'DELETE'
                }).then(r => r.json());
                showSuccess('캠페인이 삭제되었습니다!');
                loadCampaigns();
            } catch (error) {
                showError('삭제 실패');
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
    <script src="../mobile-optimization.js" defer></script>
</body>
</html>



