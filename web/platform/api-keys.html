<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <meta name="description" content="SoftFactory API key management">
    <title>API Key Center â€” SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="api.js"></script>
    <link rel="stylesheet" href="../responsive-framework.css">
    <link rel="stylesheet" href="../accessibility.css">
    <link rel="stylesheet" href="platform-dashboard-ui.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 antialiased soft-shell">
    <a href="#main" class="skip-to-main sr-only">ë©”ì¸ ì½˜í…ì¸ ë¡œ ì´ë™</a>

    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 soft-sidebar border-r border-slate-800 flex flex-col shrink-0">
            <div class="p-6 border-b border-slate-800">
                <div class="flex items-center gap-3">
                    <span class="text-2xl" aria-hidden="true">ğŸ­</span>
                    <div>
                        <h1 class="font-bold text-white">SoftFactory</h1>
                        <p class="text-xs text-slate-400">Premium SaaS</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-6 space-y-2 overflow-y-auto" aria-label="ì‚¬ìš©ì ë„¤ë¹„ê²Œì´ì…˜">
                <button class="hamburger" aria-label="ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ì—´ê¸°" type="button"><span></span><span></span><span></span></button>
                <a href="dashboard.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
                <a href="performance.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ“ˆ ì„±ëŠ¥ & ROI</a>
                <a href="billing.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ’³ ê²°ì œ ë‚´ì—­</a>
                <a href="invoices.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ§¾ ì²­êµ¬ ë‚´ì—­</a>
                <a href="profile.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ‘¤ ê³„ì •</a>
                <a href="admin.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">âš™ï¸ ê´€ë¦¬ì</a>

                <div class="my-6 border-t border-slate-800"></div>
                <p class="section-title text-xs font-semibold text-slate-400 uppercase px-4 mb-3">ì„œë¹„ìŠ¤</p>
                <a href="../sns-auto/index.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ“± SNS Auto</a>
                <a href="../review/index.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">â­ Review</a>
                <a href="../coocook/index.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ³ CooCook</a>
                <a href="../ai-automation/index.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ¤– AI Automation</a>
                <a href="../webapp-builder/index.html" class="soft-nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-slate-800 transition">ğŸ’» WebApp Builder</a>
            </nav>
            <div class="p-6 border-t border-slate-800 soft-user-panel">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-white" id="userName">Demo User</p>
                        <p class="text-xs text-slate-400" id="userEmail">demo@softfactory.com</p>
                    </div>
                    <button onclick="logout()" class="p-2 hover:bg-slate-800 rounded-lg transition" title="ë¡œê·¸ì•„ì›ƒ" type="button">ğŸšª</button>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="soft-topbar px-6 py-4 flex items-start justify-between gap-4 shrink-0">
                <div>
                    <h2 class="text-xl font-bold text-white">API Key Center</h2>
                    <p class="text-xs text-slate-400">í‚¤ ë°œê¸‰, ê¶Œí•œ, ì‚¬ìš©ëŸ‰ ì¶”ì </p>
                </div>
                <div class="flex flex-wrap items-center gap-2">
                    <button id="refreshApiKeys" type="button" class="soft-btn px-3 py-2 rounded-lg text-sm">ìƒˆë¡œê³ ì¹¨</button>
                    <button id="openKeyModal" type="button" class="soft-btn soft-btn-primary px-3 py-2 rounded-lg text-sm">ìƒˆ í‚¤ ìƒì„±</button>
                </div>
            </header>

            <main id="main" class="flex-1 overflow-y-auto soft-main space-y-6">
                <section class="soft-card p-6">
                    <div class="flex items-center justify-between gap-3 mb-4">
                        <h3 class="text-lg font-bold text-white">ë°œê¸‰ëœ í‚¤</h3>
                        <p class="text-xs text-slate-400"><span id="apiKeyCount">0</span>ê°œ (í™œì„±/ì „ì²´)</p>
                    </div>
                    <div id="apiKeyList" class="space-y-3"></div>
                </section>

                <section class="soft-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4">ê¸°ë³¸ ê¶Œí•œ í…œí”Œë¦¿</h3>
                    <div id="permissionRows" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                </section>

                <section class="soft-card p-6">
                    <h3 class="text-lg font-bold text-white mb-4">ìš”ì•½ ì§€í‘œ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <article class="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                            <p class="text-3xl font-bold text-indigo-400" id="monthlyRequests">0</p>
                            <p class="text-sm text-slate-400 mt-1">ì´ë²ˆ ë‹¬ ìš”ì²­</p>
                        </article>
                        <article class="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                            <p class="text-3xl font-bold text-green-400" id="availability">99.9%</p>
                            <p class="text-sm text-slate-400 mt-1">ê°€ìš©ì„±</p>
                        </article>
                        <article class="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                            <p class="text-3xl font-bold text-cyan-400" id="avgLatency">42ms</p>
                            <p class="text-sm text-slate-400 mt-1">í‰ê·  ì‘ë‹µì‹œê°„</p>
                        </article>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        const API_KEY_PERMISSIONS = [
            { key: 'read', label: 'Read', desc: 'ë°ì´í„° ì¡°íšŒ ê¶Œí•œ', checked: true },
            { key: 'write', label: 'Write', desc: 'ë°ì´í„° ìƒì„±/ê°±ì‹  ê¶Œí•œ', checked: false },
            { key: 'delete', label: 'Delete', desc: 'ì‚­ì œ ê¶Œí•œ', checked: false },
            { key: 'admin', label: 'Admin', desc: 'ê´€ë¦¬ìê¸‰ ê¶Œí•œ', checked: false }
        ];

        const API_KEYS_FALLBACK = [
            { id: 'key_1', name: 'Production', value: 'sk_prod_xxx8N2xL5', status: 'active', created: '2026-02-01', lastUsed: '2026-02-24 14:30', permissions: ['read', 'write'] },
            { id: 'key_2', name: 'Development', value: 'sk_dev_xxxrM7kP2', status: 'active', created: '2026-01-15', lastUsed: '2026-02-20 11:15', permissions: ['read'] },
            { id: 'key_3', name: 'Testing', value: 'sk_test_xxxxQ4nL9', status: 'revoked', created: '2025-12-01', lastUsed: '2026-02-10', permissions: ['read'] }
        ];

        let apiKeys = [...API_KEYS_FALLBACK];

        function showStatus(message, level = 'info') {
            if (typeof showSuccess === 'function' && level === 'success') return showSuccess(message);
            if (typeof showError === 'function' && (level === 'error' || level === 'warning')) return showError(message);
            if (typeof alert === 'function') return alert(message);
        }

        function safeText(id, value, fallback = '-') {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = value == null ? fallback : String(value);
        }

        function setUserInfo() {
            const user = typeof getUser === 'function' ? getUser() : null;
            if (!user) return;
            safeText('userName', user.name || 'Demo User');
            safeText('userEmail', user.email || 'demo@softfactory.com');
        }

        function permissionText(key) {
            const item = API_KEY_PERMISSIONS.find((row) => row.key === key);
            return item ? item.label : key;
        }

        function renderPermissionChecklist() {
            const host = document.getElementById('permissionRows');
            host.innerHTML = API_KEY_PERMISSIONS.map((permission) => (
                '<label class="flex items-start gap-3 p-4 soft-card">' +
                    '<input type="checkbox" class="w-4 h-4 mt-1 accent-indigo-600" data-key="' + permission.key + '">' +
                    '<div class="space-y-1">' +
                        '<p class="font-medium text-white">' + permission.label + '</p>' +
                        '<p class="text-sm text-slate-400">' + permission.desc + '</p>' +
                    '</div>' +
                '</label>'
            )).join('');
        }

        function getPermissionPayload() {
            const payload = {};
            document.querySelectorAll('#permissionRows [data-key]').forEach((checkbox) => {
                const key = checkbox.getAttribute('data-key');
                payload[key] = checkbox.checked;
            });
            return payload;
        }

        function renderApiKeys() {
            const host = document.getElementById('apiKeyList');
            const activeCount = apiKeys.filter((item) => item.status === 'active').length;
            safeText('apiKeyCount', `${activeCount}/${apiKeys.length}`);
            if (!host) return;

            host.innerHTML = apiKeys.map((item) => {
                const statusClass = item.status === 'active'
                    ? 'bg-green-900/30 text-green-300'
                    : 'bg-red-900/30 text-red-300';
                const statusLabel = item.status === 'active' ? 'í™œì„±' : 'ì¤‘ì§€';
                return (
                    '<article class="soft-card p-4">' +
                        '<div class="flex items-start justify-between gap-4">' +
                            '<div class="min-w-0 space-y-1">' +
                                '<div class="flex flex-wrap items-center gap-2">' +
                                    '<p class="font-bold text-white">' + item.name + '</p>' +
                                    '<span class="px-2 py-1 rounded-full text-xs font-semibold ' + statusClass + '">' + statusLabel + '</span>' +
                                '</div>' +
                                '<p class="text-sm text-slate-400 font-mono break-all">' + item.value + '</p>' +
                                '<p class="text-xs text-slate-500">ìƒì„±: ' + item.created + ' / ë§ˆì§€ë§‰ ì‚¬ìš©: ' + item.lastUsed + '</p>' +
                                '<p class="text-xs text-slate-500">ê¶Œí•œ: ' + item.permissions.map(permissionText).join(', ') + '</p>' +
                            '</div>' +
                            '<div class="flex gap-2 flex-shrink-0">' +
                                '<button data-copy="' + item.id + '" class="soft-btn soft-btn-ghost px-3 py-1.5 rounded-lg text-sm">ë³µì‚¬</button>' +
                                '<button data-toggle="' + item.id + '" class="soft-btn px-3 py-1.5 rounded-lg text-sm">' + (item.status === 'active' ? 'ì¤‘ì§€' : 'ì¬í™œì„±') + '</button>' +
                                '<button data-delete="' + item.id + '" class="soft-btn px-3 py-1.5 rounded-lg text-sm text-red-200 border-red-700 hover:border-red-500">ì‚­ì œ</button>' +
                            '</div>' +
                        '</div>' +
                    '</article>'
                );
            }).join('');

            host.querySelectorAll('[data-copy]').forEach((btn) => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-copy');
                    copyApiKey(id);
                });
            });
            host.querySelectorAll('[data-toggle]').forEach((btn) => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-toggle');
                    toggleApiKey(id);
                });
            });
            host.querySelectorAll('[data-delete]').forEach((btn) => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('data-delete');
                    deleteApiKey(id);
                });
            });
        }

        function copyApiKey(id) {
            const target = apiKeys.find((item) => item.id === id);
            if (!target) return;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(target.value).then(() => {
                    showStatus('API í‚¤ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }).catch(() => {
                    fallbackCopy(target.value);
                });
                return;
            }
            fallbackCopy(target.value);
        }

        function fallbackCopy(value) {
            const temp = document.createElement('textarea');
            temp.value = value;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
            showStatus('API í‚¤ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function toggleApiKey(id) {
            const target = apiKeys.find((item) => item.id === id);
            if (!target) return;
            target.status = target.status === 'active' ? 'revoked' : 'active';
            target.lastUsed = new Date().toISOString().replace('T', ' ').slice(0, 16);
            showStatus(target.status === 'active' ? 'API í‚¤ë¥¼ ë‹¤ì‹œ í™œì„±í™”í–ˆìŠµë‹ˆë‹¤.' : 'API í‚¤ë¥¼ ë¹„í™œì„±í™”í–ˆìŠµë‹ˆë‹¤.', 'success');
            renderApiKeys();
        }

        function deleteApiKey(id) {
            const next = apiKeys.filter((item) => item.id !== id);
            if (next.length === apiKeys.length) return;
            if (!window.confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            apiKeys = next;
            showStatus('API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            renderApiKeys();
        }

        function generateMaskedKey() {
            const random = Math.random().toString(36).slice(2, 12);
            const prefix = `sk_${Math.random().toString(36).slice(2, 6)}_${random}`;
            return `${prefix}***`;
        }

        function createApiKey() {
            const name = window.prompt('ìƒˆ API í‚¤ ì´ë¦„');
            if (!name) return;

            const permissionPayload = getPermissionPayload();
            const permissions = Object.entries(permissionPayload)
                .filter(([, enabled]) => enabled)
                .map(([key]) => key);

            const next = {
                id: `key_${Date.now()}`,
                name,
                value: generateMaskedKey(),
                status: 'active',
                created: new Date().toISOString().slice(0, 10),
                lastUsed: '-',
                permissions: permissions.length ? permissions : ['read']
            };
            apiKeys.unshift(next);
            showStatus(`${name} í‚¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            renderApiKeys();
        }

        function loadUsageMetrics() {
            safeText('monthlyRequests', '1,245');
            safeText('availability', '99.99%');
            safeText('avgLatency', '42ms');
        }

        function bindEvents() {
            const refreshBtn = document.getElementById('refreshApiKeys');
            const createBtn = document.getElementById('openKeyModal');
            refreshBtn?.addEventListener('click', () => {
                renderApiKeys();
                loadUsageMetrics();
                showStatus('API í‚¤ ëª©ë¡ì„ ê°±ì‹ í–ˆìŠµë‹ˆë‹¤.', 'success');
            });
            createBtn?.addEventListener('click', createApiKey);
        }

        if (typeof requireAuth === 'function') {
            requireAuth();
        }
        setUserInfo();
        renderPermissionChecklist();
        renderApiKeys();
        loadUsageMetrics();
        bindEvents();

        function logout() {
            if (typeof clearAuthToken === 'function') {
                clearAuthToken();
            }
            window.location.href = 'login.html';
        }
    </script>
    <script src="../mobile-optimization.js" defer></script>
</body>
</html>
