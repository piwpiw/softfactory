<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <title>ì‹œì‘í•˜ê¸° â€” SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="api.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }

        /* Step transition */
        .step { display: none; animation: stepIn .35s ease-out; }
        .step.active { display: block; }
        @keyframes stepIn {
            from { opacity: 0; transform: translateX(24px); }
            to   { opacity: 1; transform: translateX(0); }
        }

        /* Progress bar */
        #progress-bar {
            transition: width .4s cubic-bezier(.4,0,.2,1);
        }

        /* Service card */
        .service-card {
            cursor: pointer;
            border: 2px solid #334155;
            transition: border-color .2s, background .2s, transform .15s;
        }
        .service-card:hover {
            border-color: #7c3aed;
            background: rgba(124,58,237,.08);
            transform: translateY(-2px);
        }
        .service-card.selected {
            border-color: #7c3aed;
            background: rgba(124,58,237,.15);
        }
        .service-card .check-icon {
            display: none;
        }
        .service-card.selected .check-icon {
            display: flex;
        }

        /* Confetti animation */
        @keyframes confettiFall {
            0%   { transform: translateY(-20px) rotate(0deg);   opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .confetti-piece {
            position: fixed;
            width: 8px;
            height: 8px;
            border-radius: 2px;
            pointer-events: none;
            animation: confettiFall linear forwards;
            z-index: 9000;
        }

        /* Completion checkmark */
        @keyframes checkDraw {
            from { stroke-dashoffset: 100; }
            to   { stroke-dashoffset: 0; }
        }
        .check-circle { animation: checkDraw .6s ease-out .2s forwards; stroke-dasharray: 100; stroke-dashoffset: 100; }

        /* Profile image hover */
        #avatar-preview:hover { opacity: .85; cursor: pointer; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        @media (max-width: 640px) {
            .wizard-card { padding: 1.5rem !important; }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 antialiased min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-lg">

        <!-- Skip button -->
        <div class="flex justify-end mb-4">
            <button id="skip-btn" class="text-sm text-slate-500 hover:text-slate-300 transition px-3 py-1.5 rounded-lg hover:bg-slate-800">
                ê±´ë„ˆë›°ê¸° &rarr;
            </button>
        </div>

        <!-- Progress bar -->
        <div class="mb-6">
            <div class="flex items-center justify-between text-xs text-slate-500 mb-2">
                <span id="step-label">ë‹¨ê³„ 1 / 5</span>
                <span id="step-pct">20%</span>
            </div>
            <div class="bg-slate-800 rounded-full h-1.5 overflow-hidden">
                <div id="progress-bar" class="bg-violet-600 h-1.5 rounded-full" style="width:20%"></div>
            </div>
        </div>

        <!-- Wizard card -->
        <div class="bg-slate-900 rounded-2xl border border-slate-800 wizard-card p-8 shadow-xl shadow-black/40">

            <!-- ========================
                 STEP 1: í™˜ì˜í•©ë‹ˆë‹¤
                 ======================== -->
            <div id="step-1" class="step active">
                <div class="text-center">
                    <div class="text-6xl mb-5">SoftFactory</div>
                    <h1 class="text-2xl font-bold text-white mb-2">í™˜ì˜í•©ë‹ˆë‹¤!</h1>
                    <p id="welcome-name" class="text-slate-400 mb-6">SoftFactoryì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>ëª‡ ê°€ì§€ ë¹ ë¥¸ ì„¤ì •ìœ¼ë¡œ ìµœì ì˜ ê²½í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.</p>

                    <div class="grid grid-cols-3 gap-3 mb-8 text-sm">
                        <div class="bg-slate-800 rounded-xl p-3 text-center">
                            <div class="text-2xl mb-1">ğŸ“±</div>
                            <p class="text-slate-300 font-medium">SNS ìë™í™”</p>
                        </div>
                        <div class="bg-slate-800 rounded-xl p-3 text-center">
                            <div class="text-2xl mb-1">â­</div>
                            <p class="text-slate-300 font-medium">ì²´í—˜ë‹¨ ê´€ë¦¬</p>
                        </div>
                        <div class="bg-slate-800 rounded-xl p-3 text-center">
                            <div class="text-2xl mb-1">ğŸ¤–</div>
                            <p class="text-slate-300 font-medium">AI ìë™í™”</p>
                        </div>
                    </div>

                    <button id="start-btn" class="w-full py-3 bg-violet-600 hover:bg-violet-700 text-white font-semibold rounded-xl transition text-base">
                        ì‹œì‘í•˜ê¸° &rarr;
                    </button>
                </div>
            </div>

            <!-- ========================
                 STEP 2: ê´€ì‹¬ ì„œë¹„ìŠ¤ ì„ íƒ
                 ======================== -->
            <div id="step-2" class="step">
                <h2 class="text-xl font-bold text-white mb-1">ê´€ì‹¬ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
                <p class="text-slate-400 text-sm mb-6">ì—¬ëŸ¬ ê°œë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë³€ê²½ ê°€ëŠ¥í•´ìš”.</p>

                <div class="space-y-3 mb-8" id="service-list">
                    <label class="service-card flex items-center gap-4 p-4 rounded-xl bg-slate-800 select-none">
                        <input type="checkbox" value="sns" class="sr-only service-checkbox">
                        <span class="text-3xl">ğŸ“±</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">SNS ìë™í™”</p>
                            <p class="text-xs text-slate-400">ê²Œì‹œë¬¼ ì˜ˆì•½, AI ì½˜í…ì¸  ìƒì„±, ë¶„ì„ ë¦¬í¬íŠ¸</p>
                        </div>
                        <span class="check-icon w-6 h-6 bg-violet-600 rounded-full items-center justify-center flex-shrink-0">
                            <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                        </span>
                    </label>

                    <label class="service-card flex items-center gap-4 p-4 rounded-xl bg-slate-800 select-none">
                        <input type="checkbox" value="review" class="sr-only service-checkbox">
                        <span class="text-3xl">â­</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">ì²´í—˜ë‹¨ ê´€ë¦¬</p>
                            <p class="text-xs text-slate-400">ìë™ ì‹ ì²­, ì¶”ì , ë¦¬ë·°ì–´ ê´€ë¦¬</p>
                        </div>
                        <span class="check-icon w-6 h-6 bg-violet-600 rounded-full items-center justify-center flex-shrink-0">
                            <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                        </span>
                    </label>

                    <label class="service-card flex items-center gap-4 p-4 rounded-xl bg-slate-800 select-none">
                        <input type="checkbox" value="coocook" class="sr-only service-checkbox">
                        <span class="text-3xl">ğŸ³</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">CooCook</p>
                            <p class="text-xs text-slate-400">ì…°í”„ ì˜ˆì•½, ìš”ë¦¬ ì²´í—˜ ì„œë¹„ìŠ¤</p>
                        </div>
                        <span class="check-icon w-6 h-6 bg-violet-600 rounded-full items-center justify-center flex-shrink-0">
                            <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                        </span>
                    </label>

                    <label class="service-card flex items-center gap-4 p-4 rounded-xl bg-slate-800 select-none">
                        <input type="checkbox" value="ai" class="sr-only service-checkbox">
                        <span class="text-3xl">ğŸ¤–</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">AI ìë™í™”</p>
                            <p class="text-xs text-slate-400">ì—…ë¬´ ìë™í™”, AI ì§ì› ì„¤ì •</p>
                        </div>
                        <span class="check-icon w-6 h-6 bg-violet-600 rounded-full items-center justify-center flex-shrink-0">
                            <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                        </span>
                    </label>
                </div>

                <div class="flex gap-3">
                    <button class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl transition text-sm">
                        &larr; ì´ì „
                    </button>
                    <button id="step2-next" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white font-semibold rounded-xl transition">
                        ë‹¤ìŒ &rarr;
                    </button>
                </div>
            </div>

            <!-- ========================
                 STEP 3: í”„ë¡œí•„ ì„¤ì •
                 ======================== -->
            <div id="step-3" class="step">
                <h2 class="text-xl font-bold text-white mb-1">í”„ë¡œí•„ì„ ì„¤ì •í•˜ì„¸ìš”</h2>
                <p class="text-slate-400 text-sm mb-6">ë‚˜ì¤‘ì— ì„¤ì •ì—ì„œ ì–¸ì œë“  ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

                <!-- Avatar upload -->
                <div class="flex flex-col items-center mb-6">
                    <div class="relative cursor-pointer" id="avatar-container" onclick="document.getElementById('avatar-input').click()">
                        <div id="avatar-preview" class="w-20 h-20 rounded-full bg-violet-700 flex items-center justify-center text-3xl font-bold text-white overflow-hidden">
                            <span id="avatar-initials">?</span>
                        </div>
                        <div class="absolute bottom-0 right-0 w-7 h-7 bg-slate-700 border-2 border-slate-900 rounded-full flex items-center justify-center">
                            <svg class="w-3.5 h-3.5 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        </div>
                    </div>
                    <input type="file" id="avatar-input" accept="image/*" class="sr-only" onchange="handleAvatarChange(event)">
                    <p class="text-xs text-slate-500 mt-2">ì‚¬ì§„ í´ë¦­í•˜ì—¬ ë³€ê²½ (ì„ íƒ)</p>
                </div>

                <div class="space-y-4 mb-8">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1.5">ì´ë¦„</label>
                        <input id="profile-name" type="text" placeholder="í™ê¸¸ë™"
                            class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-2.5 text-white placeholder-slate-500 focus:border-violet-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1.5">ì—…ì¢… / ì§ì—…</label>
                        <select id="profile-industry"
                            class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:border-violet-500 focus:outline-none transition appearance-none">
                            <option value="" disabled selected>ì—…ì¢…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ecommerce">ì´ì»¤ë¨¸ìŠ¤ / ì‡¼í•‘ëª°</option>
                            <option value="food">ì™¸ì‹ / ì‹í’ˆ</option>
                            <option value="beauty">ë·°í‹° / í™”ì¥í’ˆ</option>
                            <option value="fashion">íŒ¨ì…˜ / ì˜ë¥˜</option>
                            <option value="it">IT / ì†Œí”„íŠ¸ì›¨ì–´</option>
                            <option value="marketing">ë§ˆì¼€íŒ… / ê´‘ê³ </option>
                            <option value="media">ë¯¸ë””ì–´ / í¬ë¦¬ì—ì´í„°</option>
                            <option value="education">êµìœ¡</option>
                            <option value="health">ê±´ê°• / í”¼íŠ¸ë‹ˆìŠ¤</option>
                            <option value="other">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl transition text-sm">
                        &larr; ì´ì „
                    </button>
                    <button id="step3-next" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white font-semibold rounded-xl transition">
                        ë‹¤ìŒ &rarr;
                    </button>
                </div>
            </div>

            <!-- ========================
                 STEP 4: ì²« ë²ˆì§¸ ì•¡ì…˜
                 ======================== -->
            <div id="step-4" class="step">
                <h2 class="text-xl font-bold text-white mb-1">ì²« ë²ˆì§¸ ì•¡ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”!</h2>
                <p class="text-slate-400 text-sm mb-6">ì„ íƒí•˜ì‹  ì„œë¹„ìŠ¤ë¡œ ë°”ë¡œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

                <div id="action-cards" class="space-y-3 mb-8">
                    <!-- Dynamically populated by JS -->
                </div>

                <div class="flex gap-3">
                    <button class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl transition text-sm">
                        &larr; ì´ì „
                    </button>
                    <button id="step4-next" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white font-semibold rounded-xl transition">
                        ë‹¤ìŒ &rarr;
                    </button>
                </div>
            </div>

            <!-- ========================
                 STEP 5: ì¤€ë¹„ ì™„ë£Œ
                 ======================== -->
            <div id="step-5" class="step">
                <div class="text-center py-4">
                    <!-- Animated checkmark -->
                    <div class="flex justify-center mb-6">
                        <svg class="w-24 h-24" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#1e293b" stroke-width="4"/>
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#7c3aed" stroke-width="4"
                                stroke-linecap="round"
                                style="stroke-dasharray:283;stroke-dashoffset:283;animation:checkDraw .8s ease-out .1s forwards;"/>
                            <path d="M30 52 L44 66 L70 38"
                                fill="none" stroke="#7c3aed" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"
                                style="stroke-dasharray:60;stroke-dashoffset:60;animation:checkDraw .5s ease-out .7s forwards;"/>
                        </svg>
                    </div>

                    <h2 class="text-2xl font-bold text-white mb-2">ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                    <p class="text-slate-400 mb-8 text-sm leading-relaxed">
                        SoftFactoryë¥¼ ì‹œì‘í•  ì¤€ë¹„ê°€ ëì–´ìš”.<br>
                        ëŒ€ì‹œë³´ë“œì—ì„œ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                    </p>

                    <div id="finish-summary" class="bg-slate-800 rounded-xl p-4 mb-8 text-left text-sm space-y-2">
                        <!-- Populated by JS -->
                    </div>

                    <div class="flex flex-col gap-3">
                        <button id="go-dashboard" class="w-full py-3 bg-violet-600 hover:bg-violet-700 text-white font-semibold rounded-xl transition text-base">
                            ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                        </button>
                        <a href="help.html" class="w-full py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl transition text-sm text-center">
                            ë„ì›€ì´ í•„ìš”í•˜ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”
                        </a>
                    </div>
                </div>
            </div>

        </div><!-- /.wizard-card -->

    </div><!-- /.max-w-lg -->

    <script>
    (function () {
        'use strict';

        // ---- State ----
        var state = {
            currentStep: 1,
            totalSteps: 5,
            selectedServices: [],
            name: '',
            industry: '',
            avatarDataUrl: null,
        };

        var SERVICE_ACTION_MAP = {
            sns:      { icon: 'ğŸ“±', label: 'SNS ê³„ì • ì—°ë™', desc: 'Instagram, Twitter ë“± SNS ê³„ì •ì„ ì—°ê²°í•˜ì„¸ìš”.', href: '../sns-auto/accounts.html' },
            review:   { icon: 'â­', label: 'ì²« ì²´í—˜ë‹¨ ì°¾ê¸°',  desc: 'ë¸Œëœë“œ ì²´í—˜ë‹¨ì„ ê²€ìƒ‰í•˜ê³  ì‹ ì²­í•˜ì„¸ìš”.',         href: '../review/campaigns.html' },
            coocook:  { icon: 'ğŸ³', label: 'ì…°í”„ ë‘˜ëŸ¬ë³´ê¸°',  desc: 'ì›í•˜ëŠ” ì…°í”„ë¥¼ íƒìƒ‰í•˜ê³  ì˜ˆì•½í•˜ì„¸ìš”.',           href: '../coocook/explore.html' },
            ai:       { icon: 'ğŸ¤–', label: 'AI ì§ì› ì„¤ì •',   desc: 'ì²« ë²ˆì§¸ AI ìë™í™”ë¥¼ êµ¬ì„±í•˜ì„¸ìš”.',             href: '../ai-automation/employees.html' },
        };

        // ---- Load saved state from localStorage ----
        function loadState() {
            try {
                var saved = localStorage.getItem('sf_onboarding_state');
                if (saved) {
                    var parsed = JSON.parse(saved);
                    Object.assign(state, parsed);
                }
            } catch (e) {}
        }

        function saveState() {
            try {
                localStorage.setItem('sf_onboarding_state', JSON.stringify({
                    currentStep: state.currentStep,
                    selectedServices: state.selectedServices,
                    name: state.name,
                    industry: state.industry,
                }));
            } catch (e) {}
        }

        // ---- Navigation ----
        function goToStep(n) {
            if (n < 1 || n > state.totalSteps) return;

            // Collect data from current step before leaving
            collectCurrentStepData();

            var prev = document.getElementById('step-' + state.currentStep);
            if (prev) prev.classList.remove('active');

            state.currentStep = n;
            saveState();

            var next = document.getElementById('step-' + n);
            if (next) next.classList.add('active');

            updateProgress();
            renderStepContent(n);
        }

        function updateProgress() {
            var pct = Math.round((state.currentStep / state.totalSteps) * 100);
            document.getElementById('progress-bar').style.width = pct + '%';
            document.getElementById('step-label').textContent = 'ë‹¨ê³„ ' + state.currentStep + ' / ' + state.totalSteps;
            document.getElementById('step-pct').textContent = pct + '%';
        }

        function collectCurrentStepData() {
            if (state.currentStep === 2) {
                state.selectedServices = Array.from(
                    document.querySelectorAll('.service-checkbox:checked')
                ).map(function (cb) { return cb.value; });
            }
            if (state.currentStep === 3) {
                var nameInput = document.getElementById('profile-name');
                var industryInput = document.getElementById('profile-industry');
                if (nameInput) state.name = nameInput.value.trim();
                if (industryInput) state.industry = industryInput.value;
            }
        }

        // ---- Render step-specific content ----
        function renderStepContent(n) {
            if (n === 1) renderStep1();
            if (n === 3) renderStep3();
            if (n === 4) renderStep4();
            if (n === 5) renderStep5();
        }

        function renderStep1() {
            try {
                var user = JSON.parse(localStorage.getItem('user') || '{}');
                var name = user.name || 'ì‚¬ìš©ì';
                var el = document.getElementById('welcome-name');
                if (el) el.innerHTML = '<strong class="text-white">' + name + '</strong> ë‹˜, SoftFactoryì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!<br><span class="text-sm">ëª‡ ê°€ì§€ ë¹ ë¥¸ ì„¤ì •ìœ¼ë¡œ ìµœì ì˜ ê²½í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.</span>';
                state.name = state.name || name;
            } catch (e) {}
        }

        function renderStep3() {
            var nameInput = document.getElementById('profile-name');
            var industryInput = document.getElementById('profile-industry');
            if (nameInput && state.name) nameInput.value = state.name;
            if (industryInput && state.industry) industryInput.value = state.industry;
            updateAvatarInitials(state.name);
        }

        function renderStep4() {
            var container = document.getElementById('action-cards');
            if (!container) return;

            var services = state.selectedServices.length > 0
                ? state.selectedServices
                : ['sns', 'review'];  // ê¸°ë³¸ ì¶”ì²œ

            container.innerHTML = '';

            services.slice(0, 3).forEach(function (svc) {
                var info = SERVICE_ACTION_MAP[svc];
                if (!info) return;
                var card = document.createElement('a');
                card.href = info.href;
                card.className = 'flex items-center gap-4 p-4 bg-slate-800 border border-slate-700 hover:border-violet-500 rounded-xl transition group';
                card.innerHTML = [
                    '<span class="text-3xl">' + info.icon + '</span>',
                    '<div class="flex-1">',
                    '  <p class="font-semibold text-white group-hover:text-violet-300 transition">' + info.label + '</p>',
                    '  <p class="text-xs text-slate-400">' + info.desc + '</p>',
                    '</div>',
                    '<svg class="w-5 h-5 text-slate-500 group-hover:text-violet-400 transition flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>'
                ].join('');
                container.appendChild(card);
            });

            // ì„ íƒ ì—†ëŠ” ê²½ìš° ë©”ì‹œì§€
            if (services.length === 0) {
                container.innerHTML = '<p class="text-slate-400 text-sm text-center py-4">ëŒ€ì‹œë³´ë“œì—ì„œ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ íƒìƒ‰í•˜ì„¸ìš”.</p>';
            }
        }

        function renderStep5() {
            launchConfetti();
            var summary = document.getElementById('finish-summary');
            if (!summary) return;

            var svcNames = {
                sns: 'SNS ìë™í™”', review: 'ì²´í—˜ë‹¨ ê´€ë¦¬', coocook: 'CooCook', ai: 'AI ìë™í™”'
            };

            var lines = [];
            if (state.name) {
                lines.push('<div class="flex items-center gap-2 text-slate-300"><span class="text-violet-400">&#x2713;</span> ì´ë¦„: <span class="text-white font-medium">' + state.name + '</span></div>');
            }
            if (state.selectedServices.length > 0) {
                var svcList = state.selectedServices.map(function (s) { return svcNames[s] || s; }).join(', ');
                lines.push('<div class="flex items-start gap-2 text-slate-300"><span class="text-violet-400 mt-0.5">&#x2713;</span><span>ê´€ì‹¬ ì„œë¹„ìŠ¤: <span class="text-white font-medium">' + svcList + '</span></span></div>');
            }
            lines.push('<div class="flex items-center gap-2 text-slate-300"><span class="text-violet-400">&#x2713;</span> ì˜¨ë³´ë”© ì™„ë£Œ!</div>');
            summary.innerHTML = lines.join('');
        }

        // ---- Service card selection ----
        document.getElementById('service-list').addEventListener('change', function (e) {
            if (e.target.classList.contains('service-checkbox')) {
                var card = e.target.closest('.service-card');
                if (card) card.classList.toggle('selected', e.target.checked);
            }
        });

        // ---- Avatar ----
        window.handleAvatarChange = function (evt) {
            var file = evt.target.files && evt.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) return;
            var reader = new FileReader();
            reader.onload = function (e) {
                state.avatarDataUrl = e.target.result;
                var preview = document.getElementById('avatar-preview');
                preview.innerHTML = '<img src="' + e.target.result + '" alt="í”„ë¡œí•„ ì‚¬ì§„" class="w-full h-full object-cover">';
            };
            reader.readAsDataURL(file);
        };

        function updateAvatarInitials(name) {
            var el = document.getElementById('avatar-initials');
            if (!el) return;
            if (!state.avatarDataUrl && name) {
                el.textContent = name.charAt(0).toUpperCase();
            }
        }

        document.getElementById('profile-name').addEventListener('input', function (e) {
            if (!state.avatarDataUrl) updateAvatarInitials(e.target.value);
        });

        // ---- Confetti ----
        function launchConfetti() {
            var colors = ['#7c3aed','#a78bfa','#c4b5fd','#4f46e5','#818cf8','#f59e0b','#10b981'];
            for (var i = 0; i < 60; i++) {
                (function (delay) {
                    setTimeout(function () {
                        var p = document.createElement('div');
                        p.className = 'confetti-piece';
                        p.style.cssText = [
                            'left:' + (Math.random() * 100) + 'vw',
                            'top:-10px',
                            'background:' + colors[Math.floor(Math.random() * colors.length)],
                            'animation-duration:' + (1.5 + Math.random() * 2) + 's',
                            'animation-delay:0s',
                            'border-radius:' + (Math.random() > 0.5 ? '50%' : '2px'),
                        ].join(';');
                        document.body.appendChild(p);
                        setTimeout(function () { p.remove(); }, 4000);
                    }, delay);
                })(i * 40);
            }
        }

        // ---- Button event wiring ----
        document.getElementById('start-btn').addEventListener('click', function () {
            goToStep(2);
        });

        document.getElementById('step2-next').addEventListener('click', function () {
            goToStep(3);
        });

        document.getElementById('step3-next').addEventListener('click', function () {
            var name = document.getElementById('profile-name').value.trim();
            if (!name) {
                document.getElementById('profile-name').focus();
                document.getElementById('profile-name').style.borderColor = '#ef4444';
                return;
            }
            document.getElementById('profile-name').style.borderColor = '';
            goToStep(4);
        });

        document.getElementById('step4-next').addEventListener('click', function () {
            goToStep(5);
        });

        document.getElementById('go-dashboard').addEventListener('click', function () {
            completeOnboarding();
            window.location.href = 'dashboard.html';
        });

        // Prev buttons
        document.querySelectorAll('.prev-btn').forEach(function (btn) {
            btn.addEventListener('click', function () {
                goToStep(state.currentStep - 1);
            });
        });

        // Skip button
        document.getElementById('skip-btn').addEventListener('click', function () {
            completeOnboarding();
            window.location.href = 'dashboard.html';
        });

        // ---- Mark onboarding complete ----
        function completeOnboarding() {
            try {
                localStorage.setItem('onboarding_complete', '1');
                localStorage.setItem('onboarding_completed_at', new Date().toISOString());
                localStorage.removeItem('sf_onboarding_state');
            } catch (e) {}
        }

        // ---- Init ----
        loadState();
        updateProgress();
        renderStep1();

        // Restore selections if resuming
        if (state.selectedServices.length > 0) {
            state.selectedServices.forEach(function (svc) {
                var cb = document.querySelector('.service-checkbox[value="' + svc + '"]');
                if (cb) {
                    cb.checked = true;
                    cb.closest('.service-card').classList.add('selected');
                }
            });
        }

    })();
    </script>

    <script src="/web/platform/cookie-consent.js" defer></script>
    <script src="../mobile-optimization.js" defer></script>
</body>
</html>
