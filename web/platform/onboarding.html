<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <meta name="description" content="SoftFactory ì˜¨ë³´ë”©">
    <title>ì˜¨ë³´ë”© â€” SoftFactory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="api.js"></script>
    <style>
        body {
            font-family: Inter, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        .step-progress {
            transition: width 0.35s cubic-bezier(.4, 0, .2, 1);
        }
        .service-card {
            border: 1px solid rgba(148, 163, 184, 0.25);
            cursor: pointer;
            transition: all 0.2s;
        }
        .service-card:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.08);
            transform: translateY(-1px);
        }
        .service-card.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.14);
        }
        .check-circle {
            opacity: 0;
            transform: scale(0.7);
            transition: all 0.2s;
        }
        .service-card.selected .check-circle {
            opacity: 1;
            transform: scale(1);
        }
        .avatar {
            width: 76px;
            height: 76px;
            border-radius: 9999px;
            background: #6d28d9;
            color: #fff;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .avatar-wrap {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.25);
            position: relative;
            cursor: pointer;
        }
        .avatar-wrap:after {
            content: 'í¸ì§‘';
            position: absolute;
            right: 0;
            bottom: 0;
            transform: translate(25%, 25%);
            font-size: 0.66rem;
            background: #1e293b;
            border: 1px solid #475569;
            color: #f1f5f9;
            border-radius: 9999px;
            padding: 2px 6px;
        }
        .confetti {
            position: fixed;
            top: -12px;
            width: 8px;
            height: 8px;
            z-index: 9999;
            pointer-events: none;
            border-radius: 2px;
            animation: fall 3.4s linear forwards;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0.1; }
        }
        @media (max-width: 680px) {
            .wizard {
                padding: 1.4rem !important;
            }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg">
        <div class="flex justify-end mb-4">
            <button id="skip-btn" type="button" class="text-xs px-3 py-1.5 rounded-lg bg-slate-800 text-slate-300 hover:text-white hover:bg-slate-700 transition">
                ê±´ë„ˆë›°ê¸° â†’
            </button>
        </div>

        <div class="mb-6">
            <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
                <span id="step-label">Step 1 / 5</span>
                <span id="step-pct">20%</span>
            </div>
            <div class="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                <div id="progress-bar" class="h-1.5 bg-violet-500 rounded-full step-progress" style="width: 20%"></div>
            </div>
        </div>

        <div class="bg-slate-900 border border-slate-800 rounded-2xl p-8 shadow-2xl wizard">
            <div id="step-1" class="step active">
                <div class="text-center">
                    <p class="text-xs uppercase tracking-[0.25em] text-violet-300 mb-3">Welcome</p>
                    <h1 class="text-2xl font-bold text-white mb-2">ì„œë¹„ìŠ¤ ì‹œì‘ ì•ˆë‚´</h1>
                    <p id="welcome-message" class="text-slate-400 mb-6">
                        SoftFactoryì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ê³„ì • í™˜ê²½ì„ ë°”ë¡œ ì„¤ì •í•˜ê³  ë°”ë¡œ ì‹œì‘í•˜ì„¸ìš”.
                    </p>
                    <div class="grid grid-cols-3 gap-3 text-sm mb-8">
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xl">ğŸ“±</p>
                            <p class="mt-1 text-slate-300">SNS Auto</p>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xl">â­</p>
                            <p class="mt-1 text-slate-300">Review</p>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xl">ğŸ¤–</p>
                            <p class="mt-1 text-slate-300">AI Automation</p>
                        </div>
                    </div>
                    <button id="start-btn" type="button" class="w-full py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-xl font-semibold">
                        ì‹œì‘í•˜ê¸° â†’
                    </button>
                </div>
            </div>

            <div id="step-2" class="step">
                <h2 class="text-xl font-bold text-white mb-1">ì„œë¹„ìŠ¤ ì„ íƒ</h2>
                <p class="text-slate-400 text-sm mb-6">ê°€ì…í•œ ê³„ì •ì—ì„œ ì‚¬ìš©í•  ì„œë¹„ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</p>
                <div id="service-list" class="space-y-3 mb-8">
                    <label class="service-card p-4 rounded-xl bg-slate-800 flex items-center gap-4" data-service="sns">
                        <input type="checkbox" class="service-checkbox sr-only" value="sns">
                        <span class="text-3xl">ğŸ“±</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">SNS Auto</p>
                            <p class="text-xs text-slate-400">ê²Œì‹œë¬¼ ë°œí–‰, ìë™í™”, ë¦¬í¬íŠ¸</p>
                        </div>
                        <span class="check-circle text-violet-300">âœ”</span>
                    </label>
                    <label class="service-card p-4 rounded-xl bg-slate-800 flex items-center gap-4" data-service="review">
                        <input type="checkbox" class="service-checkbox sr-only" value="review">
                        <span class="text-3xl">â­</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">Review</p>
                            <p class="text-xs text-slate-400">ë¦¬ë·° ìˆ˜ì§‘, ë°˜ì‘ ë¶„ì„, ìš´ì˜ ìµœì í™”</p>
                        </div>
                        <span class="check-circle text-violet-300">âœ”</span>
                    </label>
                    <label class="service-card p-4 rounded-xl bg-slate-800 flex items-center gap-4" data-service="coocook">
                        <input type="checkbox" class="service-checkbox sr-only" value="coocook">
                        <span class="text-3xl">ğŸ³</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">CooCook</p>
                            <p class="text-xs text-slate-400">ì½˜í…ì¸  ì œì‘, íë ˆì´ì…˜, í˜‘ì—… ì›Œí¬í”Œë¡œìš°</p>
                        </div>
                        <span class="check-circle text-violet-300">âœ”</span>
                    </label>
                    <label class="service-card p-4 rounded-xl bg-slate-800 flex items-center gap-4" data-service="ai">
                        <input type="checkbox" class="service-checkbox sr-only" value="ai">
                        <span class="text-3xl">ğŸ¤–</span>
                        <div class="flex-1">
                            <p class="font-semibold text-white">AI Automation</p>
                            <p class="text-xs text-slate-400">AI ê¸°ë°˜ ìë™í™”, í…ìŠ¤íŠ¸ ìƒì„±</p>
                        </div>
                        <span class="check-circle text-violet-300">âœ”</span>
                    </label>
                </div>
                <div class="flex gap-3">
                    <button data-prev type="button" class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl">ì´ì „</button>
                    <button id="step2-next" type="button" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white rounded-xl">ë‹¤ìŒ â†’</button>
                </div>
            </div>

            <div id="step-3" class="step">
                <h2 class="text-xl font-bold text-white mb-1">í”„ë¡œí•„ ì„¤ì •</h2>
                <p class="text-slate-400 text-sm mb-6">ì´ë¦„ê³¼ ì—…ì¢…ì„ ì €ì¥í•˜ê³  ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ì„¸ìš”.</p>

                <div class="flex flex-col items-center mb-6">
                    <label class="avatar-wrap rounded-full">
                        <div id="avatar-preview" class="avatar">S</div>
                        <input type="file" id="avatar-input" accept="image/*" class="hidden">
                    </label>
                    <p class="text-xs text-slate-500 mt-2">í´ë¦­í•´ ì•„ë°”íƒ€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                </div>

                <div class="space-y-4 mb-8">
                    <div>
                        <label for="profile-name" class="block text-sm font-medium text-slate-300 mb-1.5">ì´ë¦„</label>
                        <input id="profile-name" type="text" placeholder="í™ê¸¸ë™" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-2.5 text-white">
                    </div>
                    <div>
                        <label for="profile-industry" class="block text-sm font-medium text-slate-300 mb-1.5">ì—…ì¢…</label>
                        <select id="profile-industry" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-2.5 text-white">
                            <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ecommerce">ì´ì»¤ë¨¸ìŠ¤ / ì˜¨ë¼ì¸ëª°</option>
                            <option value="food">ì‹ìŒë£Œ</option>
                            <option value="beauty">ë·°í‹° / íŒ¨ì…˜</option>
                            <option value="it">IT / SaaS</option>
                            <option value="marketing">ë§ˆì¼€íŒ… / ê´‘ê³ </option>
                            <option value="media">ë¯¸ë””ì–´ / ì»¤ë®¤ë‹ˆí‹°</option>
                            <option value="education">êµìœ¡</option>
                            <option value="health">í—¬ìŠ¤ì¼€ì–´</option>
                            <option value="other">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button data-prev type="button" class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl">ì´ì „</button>
                    <button id="step3-next" type="button" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white rounded-xl">ë‹¤ìŒ â†’</button>
                </div>
            </div>

            <div id="step-4" class="step">
                <h2 class="text-xl font-bold text-white mb-1">ë°”ë¡œê°€ê¸° ì¶”ì²œ</h2>
                <p class="text-slate-400 text-sm mb-6">ì„ íƒí•œ ì„œë¹„ìŠ¤ì˜ ì§„ì… ê²½ë¡œë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.</p>
                <div id="action-cards" class="space-y-3 mb-8"></div>
                <div class="flex gap-3">
                    <button data-prev type="button" class="prev-btn flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl">ì´ì „</button>
                    <button id="step4-next" type="button" class="flex-1 py-2.5 bg-violet-600 hover:bg-violet-700 text-white rounded-xl">ë‹¤ìŒ â†’</button>
                </div>
            </div>

            <div id="step-5" class="step">
                <div class="text-center py-3">
                    <div class="mx-auto w-24 h-24 rounded-full bg-violet-900/40 border border-violet-500/50 flex items-center justify-center text-4xl mb-6">âœ“</div>
                    <h2 class="text-2xl font-bold text-white mb-2">ì˜¨ë³´ë”© ì™„ë£Œ</h2>
                    <p class="text-slate-400 mb-8 text-sm leading-relaxed">
                        ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë°”ë¡œ ëŒ€ì‹œë³´ë“œì—ì„œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <div id="finish-summary" class="bg-slate-800 border border-slate-700 rounded-xl p-4 mb-8 text-left text-sm space-y-2"></div>
                    <div class="flex flex-col gap-3">
                        <button id="go-dashboard" type="button" class="w-full py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-xl">ëŒ€ì‹œë³´ë“œ ë°”ë¡œê°€ê¸°</button>
                        <a href="help.html" class="w-full py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl text-center">ë„ì›€ë§ ë³´ê¸°</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const STORAGE_KEY = 'sf_onboarding_state_v2';
            const state = {
                currentStep: 1,
                totalSteps: 5,
                selectedServices: [],
                name: '',
                industry: '',
                avatarDataUrl: ''
            };

            const serviceMap = {
                sns: { icon: 'ğŸ“±', label: 'SNS Auto', desc: 'ê²Œì‹œë¬¼ ìë™í™”, ë¶„ì„, ë¦¬í¬íŠ¸', href: '../sns-auto/index.html' },
                review: { icon: 'â­', label: 'Review', desc: 'ë¦¬ë·° ìˆ˜ì§‘/ë¶„ì„/ì•Œë¦¼', href: '../review/index.html' },
                coocook: { icon: 'ğŸ³', label: 'CooCook', desc: 'ì½˜í…ì¸  ì œì‘ ì›Œí¬í”Œë¡œìš°', href: '../coocook/index.html' },
                ai: { icon: 'ğŸ¤–', label: 'AI Automation', desc: 'ë¬¸ì•ˆ ìƒì„±, ìë™í™” ê·œì¹™', href: '../ai-automation/index.html' }
            };

            function loadState() {
                try {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (!saved) return;
                    const parsed = JSON.parse(saved);
                    Object.assign(state, parsed || {});
                } catch (_) {}
            }

            function saveState() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    currentStep: state.currentStep,
                    selectedServices: state.selectedServices,
                    name: state.name,
                    industry: state.industry
                }));
            }

            function renderStep(step) {
                for (let i = 1; i <= state.totalSteps; i++) {
                    const target = document.getElementById(`step-${i}`);
                    if (target) target.classList.toggle('active', i === step);
                }
                updateProgress();
                if (step === 1) renderStep1();
                if (step === 3) renderStep3();
                if (step === 4) renderStep4();
                if (step === 5) renderStep5();
            }

            function updateProgress() {
                const pct = Math.max(1, Math.round((state.currentStep / state.totalSteps) * 100));
                const bar = document.getElementById('progress-bar');
                const label = document.getElementById('step-label');
                const pctEl = document.getElementById('step-pct');
                if (bar) bar.style.width = pct + '%';
                if (label) label.textContent = `Step ${state.currentStep} / ${state.totalSteps}`;
                if (pctEl) pctEl.textContent = `${pct}%`;
            }

            function collectStepData() {
                if (state.currentStep === 2) {
                    state.selectedServices = Array.from(document.querySelectorAll('.service-checkbox:checked')).map((cb) => cb.value);
                }
                if (state.currentStep === 3) {
                    const nameInput = document.getElementById('profile-name');
                    const industryInput = document.getElementById('profile-industry');
                    state.name = (nameInput && nameInput.value.trim()) || '';
                    state.industry = (industryInput && industryInput.value) || '';
                }
            }

            function showError(el, message) {
                if (!el) return;
                el.textContent = message;
                el.classList.remove('hidden');
                clearTimeout(showError.tid);
                showError.tid = setTimeout(() => { el.classList.add('hidden'); }, 2500);
            }

            function renderStep1() {
                const user = typeof getUser === 'function' ? getUser() : {};
                const userName = user && user.name ? user.name : 'ì‚¬ìš©ì';
                const box = document.getElementById('welcome-message');
                if (box) {
                    box.innerHTML = `<strong class="text-white">${escapeHtml(userName)}</strong>ë‹˜, SoftFactory ì˜¨ë³´ë”©ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br><span class="text-sm">ìµœì  í™˜ê²½ìœ¼ë¡œ ë°”ë¡œ ì‹œì‘í•  ìˆ˜ ìˆê²Œ ë„ì™€ë“œë¦´ê²Œìš”.</span>`;
                }
                state.name = state.name || userName;
            }

            function renderStep3() {
                const nameInput = document.getElementById('profile-name');
                const industryInput = document.getElementById('profile-industry');
                if (nameInput && state.name) nameInput.value = state.name;
                if (industryInput && state.industry) industryInput.value = state.industry;
                updateAvatarPreview();
            }

            function renderStep4() {
                const container = document.getElementById('action-cards');
                if (!container) return;
                const selected = state.selectedServices.length > 0 ? state.selectedServices : Object.keys(serviceMap);
                container.innerHTML = '';
                selected.forEach((service) => {
                    const row = serviceMap[service];
                    if (!row) return;
                    const card = document.createElement('a');
                    card.className = 'flex items-center gap-4 p-4 bg-slate-800 border border-slate-700 rounded-xl hover:border-violet-500 transition';
                    card.href = row.href;
                    card.innerHTML = `
                        <span class="text-2xl">${row.icon}</span>
                        <div class="flex-1">
                          <p class="font-semibold text-white">${row.label}</p>
                          <p class="text-xs text-slate-400">${row.desc}</p>
                        </div>
                        <span class="text-xs text-violet-300">ë°”ë¡œê°€ê¸°</span>
                    `;
                    container.appendChild(card);
                });
            }

            function renderStep5() {
                const summary = document.getElementById('finish-summary');
                if (!summary) return;
                const serviceLabels = state.selectedServices.length ? state.selectedServices.map((key) => serviceMap[key] ? serviceMap[key].label : key).join(', ') : 'ì„ íƒí•œ í•­ëª© ì—†ìŒ';
                summary.innerHTML = [
                    `<div class="flex items-center gap-2 text-slate-300"><span class="text-violet-300">âœ“</span>ì´ë¦„: <span class="text-white font-medium">${escapeHtml(state.name || '-')}</span></div>`,
                    `<div class="flex items-center gap-2 text-slate-300"><span class="text-violet-300">âœ“</span>ì—…ì¢…: <span class="text-white font-medium">${state.industry || '-'}</span></div>`,
                    `<div class="flex items-center gap-2 text-slate-300"><span class="text-violet-300">âœ“</span>ì„ íƒ ì„œë¹„ìŠ¤: <span class="text-white font-medium">${serviceLabels}</span></div>`
                ].join('');
                launchConfetti();
            }

            function goToStep(next) {
                if (next < 1 || next > state.totalSteps) return;
                collectStepData();
                if (next === 3 && state.currentStep === 2 && state.selectedServices.length === 0) {
                    alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (next === 5 && state.currentStep === 4) {
                    if (!state.name) {
                        alert('ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                        goToStep(3);
                        return;
                    }
                }

                state.currentStep = next;
                saveState();
                renderStep(state.currentStep);
            }

            function handleCardSelection(e) {
                const target = e.target.closest('.service-card');
                if (!target) return;
                const checkbox = target.querySelector('.service-checkbox');
                if (!checkbox) return;
                checkbox.checked = !checkbox.checked;
                target.classList.toggle('selected', checkbox.checked);
            }

            function updateAvatarPreview() {
                const avatar = document.getElementById('avatar-preview');
                if (!avatar) return;
                if (state.avatarDataUrl) {
                    avatar.innerHTML = `<img src="${state.avatarDataUrl}" alt="avatar" />`;
                } else {
                    const char = (state.name || 'S').trim().charAt(0).toUpperCase() || 'S';
                    avatar.textContent = char;
                }
            }

            function updateAvatar(e) {
                const file = e.target.files && e.target.files[0];
                if (!file || !file.type.startsWith('image/')) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    state.avatarDataUrl = evt.target.result;
                    updateAvatarPreview();
                };
                reader.readAsDataURL(file);
            }

            function escapeHtml(value) {
                return String(value)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;');
            }

            function launchConfetti() {
                const colors = ['#8b5cf6', '#a78bfa', '#f59e0b', '#10b981', '#60a5fa', '#f472b6'];
                for (let i = 0; i < 50; i += 1) {
                    const piece = document.createElement('div');
                    piece.className = 'confetti';
                    piece.style.left = `${Math.random() * 100}vw`;
                    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                    piece.style.animationDuration = `${1.4 + Math.random() * 1.8}s`;
                    piece.style.animationDelay = `${Math.random() * 0.4}s`;
                    piece.style.opacity = `${0.7 + Math.random() * 0.3}`;
                    piece.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(piece);
                    setTimeout(() => piece.remove(), 3500);
                }
            }

            document.getElementById('start-btn')?.addEventListener('click', () => goToStep(2));
            document.getElementById('step2-next')?.addEventListener('click', () => goToStep(3));
            document.getElementById('step3-next')?.addEventListener('click', () => {
                const name = document.getElementById('profile-name').value.trim();
                if (!name) {
                    const n = document.getElementById('profile-name');
                    n.focus();
                    n.classList.add('border-red-400');
                    return showError(n, 'ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                }
                document.getElementById('profile-name').classList.remove('border-red-400');
                goToStep(4);
            });
            document.getElementById('step4-next')?.addEventListener('click', () => goToStep(5));
            document.getElementById('go-dashboard')?.addEventListener('click', () => {
                localStorage.setItem('onboarding_complete', '1');
                localStorage.setItem('onboarding_completed_at', new Date().toISOString());
                localStorage.removeItem(STORAGE_KEY);
                window.location.href = 'dashboard.html';
            });
            document.getElementById('skip-btn')?.addEventListener('click', () => {
                localStorage.setItem('onboarding_complete', '1');
                window.location.href = 'dashboard.html';
            });
            document.querySelectorAll('.prev-btn').forEach((btn) => {
                btn.addEventListener('click', () => goToStep(state.currentStep - 1));
            });
            document.getElementById('service-list')?.addEventListener('click', handleCardSelection);
            document.getElementById('avatar-input')?.addEventListener('change', updateAvatar);
            document.getElementById('avatar-preview')?.addEventListener('click', () => {
                document.getElementById('avatar-input').click();
            });
            document.getElementById('profile-name')?.addEventListener('input', (e) => {
                state.name = e.target.value.trim();
                updateAvatarPreview();
            });
            document.getElementById('profile-industry')?.addEventListener('change', (e) => {
                state.industry = e.target.value;
            });

            loadState();
            renderStep(state.currentStep);
            if (state.currentStep === 2 || state.currentStep === 3 || state.currentStep === 4 || state.currentStep === 5) {
                collectStepData();
            }

            // Restore step-2 selection if resuming
            if (state.selectedServices.length > 0) {
                state.selectedServices.forEach((svc) => {
                    const cb = document.querySelector(`.service-checkbox[value="${svc}"]`);
                    if (cb) {
                        cb.checked = true;
                        cb.closest('.service-card')?.classList.add('selected');
                    }
                });
            }
        })();
    </script>
</body>
</html>
