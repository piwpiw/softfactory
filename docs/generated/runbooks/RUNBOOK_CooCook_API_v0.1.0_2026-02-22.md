# Deployment Runbook: CooCook API v0.1.0

**Date:** 2026-02-22
**Author:** Agent 09 / DevOps-Engineer
**Strategy:** Blue-Green | Rolling | Canary

---

## ⚠️ Prerequisites
- All items below MUST be confirmed before starting deployment.

---

## 1. Pre-Deployment Checklist

- [ ] CI checks passing
- [ ] Security clearance confirmed
- [ ] QA sign-off confirmed
- [ ] DB migrations reviewed
- [ ] Rollback tested within 30 days

- [ ] All CI checks passing on release branch
- [ ] Security scan: no new CRITICAL/HIGH findings
- [ ] Database migrations reviewed and tested on staging
- [ ] Rollback procedure tested within last 30 days
- [ ] On-call engineer confirmed available
- [ ] Maintenance window communicated (if applicable)
- [ ] Feature flags configured correctly for rollout

---

## 2. Deployment Steps

1. Build Docker image: `docker build -t coocook-api:{version} .`
2. Push to ECR registry
3. Update GitOps repo image tag (Green environment)
4. ArgoCD reconciles — Green environment deployed
5. Run smoke tests on Green
6. Switch ALB target group: Blue → Green
7. Monitor for 15 minutes

### Step 1: Build & Verify Artifact
```bash
# Example: Docker image build + push
docker build -t service:0.1.0 .
docker push registry/service:0.1.0
```

### Step 2: Update Infrastructure (GitOps)
```bash
# Update image tag in GitOps repo
# ArgoCD / Flux will auto-reconcile
```

### Step 3: Monitor Rollout
- Watch deployment progress
- Monitor error rate and latency in Grafana
- Check logs for ERROR/CRITICAL entries

---

## 3. Health Checks

GET /health → 200 OK
GET /ready → 200 OK
Error rate < 0.1% (Grafana dashboard)
p99 latency < 500ms (Grafana dashboard)

| Check | Command / URL | Expected | Timeout |
|-------|-------------|----------|---------|
| Liveness | GET /health | 200 OK | 30s |
| Readiness | GET /ready | 200 OK | 30s |
| Error rate | Grafana dashboard | < 0.1% | 5 min |
| p99 latency | Grafana dashboard | < 500ms | 5 min |

---

## 4. Rollback Procedure

Trigger: error rate > 1% for > 2 minutes
Action: switch ALB back to Blue environment
Target: < 2 minutes rollback time
GitOps: revert image tag commit

### Trigger Conditions
- Error rate > 1% sustained for > 2 minutes
- p99 latency > 1000ms sustained for > 2 minutes
- Any P0 bug observed post-deployment

### Rollback Steps
```bash
# Blue-Green: switch traffic back to Blue
# GitOps: revert commit in infra repo

git revert HEAD --no-edit
git push origin main
# ArgoCD auto-reconciles to previous state
```

**Target rollback time: < 2 minutes**

---

## 5. Post-Deployment Verification

- [ ] Health checks passing
- [ ] Error rate baseline confirmed
- [ ] Key user journeys smoke-tested
- [ ] SLO dashboard: availability ≥ 99.9%
- [ ] Stakeholders notified

- [ ] Health checks passing (all environments)
- [ ] Error rate stable (< baseline)
- [ ] Key user journeys tested (smoke test suite)
- [ ] SLO dashboard: availability ≥ target
- [ ] Log volume normal (no error spikes)
- [ ] Stakeholders notified of successful deployment

---

## 6. Incident Response

P0 (service down): page DevOps lead immediately
P1 (major degradation): 15-min response
P2 (partial impact): 1-hour response
All incidents → blameless post-mortem within 48h

### Severity Levels
| Level | Criteria | Response Time | Escalation |
|-------|----------|---------------|------------|
| P0 | Service down | Immediate | CTO + DevOps |
| P1 | Major degradation | 15 min | DevOps lead |
| P2 | Partial impact | 1 hour | On-call |
| P3 | Minor issue | Next business day | Team |

### Contacts
| Role | Name | Slack | Phone |
|------|------|-------|-------|
| DevOps Lead | — | — | — |
| On-call | — | — | — |

---

## 7. Deployment Log

| Timestamp | Action | Operator | Result |
|-----------|--------|----------|--------|
| — | Deployment started | — | — |
| — | Health checks passed | — | — |
| — | Deployment confirmed | — | — |

---

*Generated by Deca-Agent Document Engine | Template: DEPLOYMENT_RUNBOOK_TEMPLATE.md*
